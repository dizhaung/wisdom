@app(name='WisdomApp', version='1.0.0')
def stream PacketStream;
def stream IPSweepStream;
def variable time_threshold = 1000;
def variable count_threshold = 50;

@query(name='IPSweepQuery')
from PacketStream
    filter protocol == "icmp"
    partition by srcIp
    window.unique:externalTimeBatch('destIp', 'timestamp', $time_threshold)
    aggregate count() as no_of_packets
    filter no_of_packets > $count_threshold
    select srcIp, destIp, no_of_packets, timestamp
insert into IPSweepStream;
